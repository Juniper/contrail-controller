{
  "comments": [
    {
      "key": {
        "uuid": "9f5c4f37_3dc1992f",
        "filename": "src/config/api-server/vnc_cfg_api_server/tests/test_perms2.py",
        "patchSetId": 2
      },
      "lineNbr": 793,
      "author": {
        "id": 10
      },
      "writtenOn": "2019-06-04T08:50:52Z",
      "side": 1,
      "message": "This should failed as the \u0027is_shared\u0027 VN property was not set to true. I think this is another bug we discussed, where property list filter is only applied on the owned resources and not on shared resources.",
      "revId": "8508ce0ee960f031c328922dae1ea7e98b9fd9f8",
      "serverId": "c72cd27d-1743-4a55-84a4-cd13b8400c52",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "9f5c4f37_b15ff270",
        "filename": "src/config/api-server/vnc_cfg_api_server/tests/test_perms2.py",
        "patchSetId": 2
      },
      "lineNbr": 793,
      "author": {
        "id": 623
      },
      "writtenOn": "2019-06-06T23:24:13Z",
      "side": 1,
      "message": "Ã‰douard, I think the is_shared does get applied. If you see this: https://github.com/Juniper/contrail-controller/blob/7c09b63c48d53e8078dcaa0e580ec9ce302a0d70/src/config/api-server/vnc_cfg_api_server/vnc_db.py#L1627-L1638\n\nHere, \u0027is_shared\u0027 is applied at line 1627. The shared\u003dTrue is then applied for line 1638",
      "parentUuid": "9f5c4f37_3dc1992f",
      "revId": "8508ce0ee960f031c328922dae1ea7e98b9fd9f8",
      "serverId": "c72cd27d-1743-4a55-84a4-cd13b8400c52",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "9f5c4f37_8c13b55c",
        "filename": "src/config/api-server/vnc_cfg_api_server/tests/test_perms2.py",
        "patchSetId": 2
      },
      "lineNbr": 793,
      "author": {
        "id": 10
      },
      "writtenOn": "2019-06-07T08:17:13Z",
      "side": 1,
      "message": "Agree but here in that test, VN is owned by Alice and shared with Bob. That VN have property \u0027is_shared\u0027 to false (default value). Then network list done by Bob with filter \u0027is_shared\u003dFalse\u0027 should not return the VN. But as you said filter on properties is only applied on owned resources and not on shared ones. This is another bug.\n\nMy comment is why did you add that test for that patch?\n\nBtw, did you see that code https://github.com/Juniper/contrail-controller/blob/master/src/config/api-server/vnc_cfg_api_server/resources/virtual_network.py#L494-L515 I think it could compete for obfuscated code contest :)",
      "parentUuid": "9f5c4f37_b15ff270",
      "revId": "8508ce0ee960f031c328922dae1ea7e98b9fd9f8",
      "serverId": "c72cd27d-1743-4a55-84a4-cd13b8400c52",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "28496b4b_e21ef122",
        "filename": "src/config/api-server/vnc_cfg_api_server/tests/test_perms2.py",
        "patchSetId": 2
      },
      "lineNbr": 793,
      "author": {
        "id": 623
      },
      "writtenOn": "2019-07-09T02:00:36Z",
      "side": 1,
      "message": "I added the filter to the patch because if we don\u0027t add the filters, this code will be executed:\nhttps://github.com/Juniper/contrail-controller/blob/7c09b63c48d53e8078dcaa0e580ec9ce302a0d70/src/config/api-server/vnc_cfg_api_server/vnc_db.py#L1627-L1632\n\nAnd this code will fetch all the networks and will work as expected.\nHowever, in the real world example, when network list is invoked from vnc_openstack, it\u0027s always invoked with either a project_id as parent or either one of \"external_router\" or \"is_shared\" filters enabled, in case of which the above code will not return any data which was the ticket\u0027s original problem.",
      "parentUuid": "9f5c4f37_8c13b55c",
      "revId": "8508ce0ee960f031c328922dae1ea7e98b9fd9f8",
      "serverId": "c72cd27d-1743-4a55-84a4-cd13b8400c52",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "64195162_304e99b8",
        "filename": "src/config/api-server/vnc_cfg_api_server/tests/test_perms2.py",
        "patchSetId": 2
      },
      "lineNbr": 793,
      "author": {
        "id": 10
      },
      "writtenOn": "2019-07-09T07:40:54Z",
      "side": 1,
      "message": "Without your patch on _id_perms, that test fails?\nWhat I mean here, is that \u0027is_shared\u0027 filter does not do anything as we don\u0027t apply filter on shared resource. See \u0027collect_shared\u0027 method does not apply any filters. So in that test Alice\u0027s VN have \u0027is_share\u0027 to false (default value), so the list call here should not list it.",
      "parentUuid": "28496b4b_e21ef122",
      "revId": "8508ce0ee960f031c328922dae1ea7e98b9fd9f8",
      "serverId": "c72cd27d-1743-4a55-84a4-cd13b8400c52",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "9f5c4f37_bdea29a9",
        "filename": "src/config/api-server/vnc_cfg_api_server/vnc_db.py",
        "patchSetId": 2
      },
      "lineNbr": 1602,
      "author": {
        "id": 10
      },
      "writtenOn": "2019-06-04T08:50:52Z",
      "side": 1,
      "message": "So the solution you propose is to do fetch shared resource with both format of the owner UUID (with and without hyphens)?",
      "revId": "8508ce0ee960f031c328922dae1ea7e98b9fd9f8",
      "serverId": "c72cd27d-1743-4a55-84a4-cd13b8400c52",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "9f5c4f37_91562e5c",
        "filename": "src/config/api-server/vnc_cfg_api_server/vnc_db.py",
        "patchSetId": 2
      },
      "lineNbr": 1602,
      "author": {
        "id": 623
      },
      "writtenOn": "2019-06-06T23:24:13Z",
      "side": 1,
      "message": "Yes. Exactly. Do you think we could do it better in any ways ?",
      "parentUuid": "9f5c4f37_bdea29a9",
      "revId": "8508ce0ee960f031c328922dae1ea7e98b9fd9f8",
      "serverId": "c72cd27d-1743-4a55-84a4-cd13b8400c52",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "9f5c4f37_8c3cd5c8",
        "filename": "src/config/api-server/vnc_cfg_api_server/vnc_db.py",
        "patchSetId": 2
      },
      "lineNbr": 1602,
      "author": {
        "id": 10
      },
      "writtenOn": "2019-06-07T08:17:13Z",
      "side": 1,
      "message": "I think we should decide which format we like to use and save in the DB and fix the code to respects it and adds a migration path to update existing resources. We have to status on that.",
      "parentUuid": "9f5c4f37_91562e5c",
      "revId": "8508ce0ee960f031c328922dae1ea7e98b9fd9f8",
      "serverId": "c72cd27d-1743-4a55-84a4-cd13b8400c52",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "3421e352_07cee1ff",
        "filename": "src/config/api-server/vnc_cfg_api_server/vnc_db.py",
        "patchSetId": 2
      },
      "lineNbr": 1602,
      "author": {
        "id": 623
      },
      "writtenOn": "2019-07-02T04:42:40Z",
      "side": 1,
      "message": "I looked into the code and it looks like everywhere for share list, we store the UUID with \"-\" in them. I\u0027ve updated the code review to remove the convertion of \"-\" to \"\" in _owner_id function.",
      "parentUuid": "9f5c4f37_8c3cd5c8",
      "revId": "8508ce0ee960f031c328922dae1ea7e98b9fd9f8",
      "serverId": "c72cd27d-1743-4a55-84a4-cd13b8400c52",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "d79e3c01_094c8514",
        "filename": "src/config/api-server/vnc_cfg_api_server/vnc_db.py",
        "patchSetId": 2
      },
      "lineNbr": 1602,
      "author": {
        "id": 10
      },
      "writtenOn": "2019-07-09T07:40:54Z",
      "side": 1,
      "message": "Should we also do a migration path for existing data in the sharing table to verify they only use hyphen UUID version?",
      "parentUuid": "3421e352_07cee1ff",
      "revId": "8508ce0ee960f031c328922dae1ea7e98b9fd9f8",
      "serverId": "c72cd27d-1743-4a55-84a4-cd13b8400c52",
      "unresolved": false
    }
  ]
}