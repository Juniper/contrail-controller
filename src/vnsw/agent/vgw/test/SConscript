#
# Copyright (c) 2013 Juniper Networks, Inc. All rights reserved.
#

# -*- mode: python; -*-

import re

Import('AgentEnv')
env = AgentEnv.Clone()

env.Prepend(LIBS=['gunit'])
cflags = env['CCFLAGS']
if '-fno-exceptions' in cflags:
    cflags.remove('-fno-exceptions')
    cflags.append('-Wno-return-type')
    env.Replace(CCFLAGS = cflags)

import sys
if sys.platform != 'darwin':
    env.Append(LIBPATH=['../../test'])
    env.Prepend(LIBS=['agent_test'])
    env.Append(LIBS=['agent_test_buildinfo'])

    test_vgw = env.Program(target = 'test_vgw', source = ['test_vgw.cc'])
    env.Alias('agent:test_vgw', test_vgw)

    test_dynamic_vgw = env.Program(target = 'test_dynamic_vgw', source = ['test_dynamic_vgw.cc'])
    env.Alias('agent:test_dynamic_vgw', test_dynamic_vgw)

    vgw_suite = [test_vgw, test_dynamic_vgw]

test = env.TestSuite('agent-test', vgw_suite)
env.Alias('controller/src/vnsw/agent/vgw:test', test)
Return('vgw_suite')

