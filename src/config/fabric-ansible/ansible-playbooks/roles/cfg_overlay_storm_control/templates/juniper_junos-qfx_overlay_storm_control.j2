{%- set sc_profile = device_abstract_config.get('storm_control', {}) %}
{%- set sc_profile_name = sc_profile.get('name') %}
{%- set sc_bw_percent = sc_profile.get('bandwidth_percent') %}
{%- set sc_actions = sc_profile.get('actions') %}
{%- set sc_traffic_types = sc_profile.get('traffic_type') %}
{%- set sc_recovery_timeout = sc_profile.get('recovery_timeout') %}

{%  for phy_int in device_abstract_config.get('physical_interfaces', []) %}
{%-     for li in phy_int.get('logical_interfaces', []) %}
{%-         if li.get('storm_control') %}
set interfaces {{phy_int.name}} unit 0 family ethernet-switching storm-control {{sc_profile_name}}
{%-             if 'interface-shutdown' in sc_actions %}
set interfaces {{phy_int.name}} unit 0 family ethernet-switching recovery-timeout {{sc_recovery_timeout | default(600, true) }}
{%-             endif %}
{%-         endif %}
{%-     endfor %}
{%- endfor %}

{%- for action in sc_actions %}
{%-     if action == 'interface-shutdown' %}
set forwarding-options storm-control-profiles {{sc_profile_name}} action-shutdown
{%-     endif %}
{%- endfor %}

{%- set sc_traffic_options_str = ' '.join(sc_traffic_types) %}
set forwarding-options storm-control-profiles {{sc_profile_name}} all bandwidth-percentage {{sc_bw_percent}} {{sc_traffic_options_str}}