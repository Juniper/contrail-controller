{%- set cfg_group = "__contrail_" + feature + "__" %}
delete apply-groups {{cfg_group}}
delete groups {{cfg_group}}

{% if device_abstract_config is defined and device_abstract_config != None %}
{%     for ifd in device_abstract_config.get('physical_interfaces', []) %}
{%         if ifd.get('interface_type') == 'lag' and  ifd.get('link_aggregation_group')!= None %}
set groups {{cfg_group}} chassis aggregated-devices ethernet device-count 1
set groups {{cfg_group}} interfaces {{ifd.name}} aggregated-ether-options minimum-links 1
{%             for inter in ifd.link_aggregation_group.link_members %}
set groups {{cfg_group}} interfaces {{inter}} ether-options 802.3ad {{ifd.name}}
{%                 if ifd.link_aggregation_group.lacp_enabled == True %}
set groups {{cfg_group}} interfaces {{ifd.name}} aggregated-ether-options lacp active
set groups {{cfg_group}} interfaces {{ifd.name}} aggregated-ether-options lacp periodic fast
{%                 else %}
delete interfaces {{ifd.name}} aggregated-ether-options lacp
{%                 endif %}
{%             endfor %}
set apply-groups {{cfg_group}}
{%         endif %}
{%      endfor %}
{% endif %}
