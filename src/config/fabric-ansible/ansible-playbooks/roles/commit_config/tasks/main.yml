---
    - name: create subfolders
      include_tasks: create_subfolders.yml

    # Append a job log to record the config to be deployed
    - name: Config to be deployed to device
      set_fact:
        final_cfg: "{{ item }}"
      with_file:
        - "{{ conf_dir }}/final_config/combined_config.cfg"

    - debug: var=final_cfg

    - name: Create a job log for deploying the config
      job_objectlog:
        job_ctx: "{{ job_ctx }}"
        message: "Deploying following config to device '{{ prouter_info.display_name }}' (it may take a while)\n{{ final_cfg }}"
        status: "{{ JOBLOG_STATUS.IN_PROGRESS }}"

    - name: Pushing config ... please wait
      junos_config:
        src: "{{ conf_dir }}/final_config/combined_config.cfg"
        comment: "Applied by Ansible"
        provider:
          host: "{{ junos_host }}"
          username: "{{ junos_username }}"
          password: "{{ junos_password }}"
          port: 22
          timeout: "{{ JUNOS_COMMIT_TIMEOUT | int }}"
        confirm_commit: yes
      ignore_errors: yes
      register: result

    - name: handle error case to extract message from device
      include_tasks: handle_error_junos.yml
      when: "result.failed == true" #Do not change to failure as ansible returns as 'failed'

    - name: delete all generated configs
      file:
        state: absent
        path: "{{ conf_dir }}"
