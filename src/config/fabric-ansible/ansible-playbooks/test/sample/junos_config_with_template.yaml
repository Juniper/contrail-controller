---
# Invoke as: ansible-playbook -e "INPUT_JSON_STRING=\'{\"if_name\":\"ge-0/0/1\"}\'" junos_config_with_template.yaml

- name: Push Junos Config and Read Back Facts
  hosts: localhost
  vars:
    junos_host: 10.155.67.6
    junos_username: root
    junos_password: Embe1mpls
    input_json: "{{INPUT_JSON_STRING}}"
  roles:
    - Juniper.junos

  tasks:
    - name: Print input json
      debug: msg="{{input_json}}"

    - name: Render config template
      template:
        src: mx_cfg.j2
        dest: ./mx1.cfg
    - name: Check NETCONF connectivity
      wait_for: host="{{junos_host}}" port=830 timeout=30

    - name: Push Junos Config
      junos_config:
        provider:
          host: "{{junos_host}}"
          username: "{{junos_username}}"
          password: "{{junos_password}}"
          port: 22
        confirm_commit: yes
        src: mx1.cfg
        comment: update config

    - name: Read Junos Facts
      juniper_junos_facts:
        provider:
          host: "{{junos_host}}"
          username: "{{junos_username}}"
          password: "{{junos_password}}"
          port: 22
        config_format: text
      register: mx_info

    - name: PRINT MX INFORMATION
      debug: msg="{{mx_info}}"
