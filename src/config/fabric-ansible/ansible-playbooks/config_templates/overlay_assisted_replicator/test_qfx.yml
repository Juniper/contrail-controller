---
- name: Onboard fabric data model to the database

  hosts: localhost
  connection: local
  gather_facts: no

  vars:
    feature: overlay_assisted_replicator
    cfg_group: __contrail_overlay_assisted_replication__
  tasks:
    - set_fact:
        device_abstract_config: {
          "comment": "/* Contrail Generated Group Config */",
          "features": {
            "telemetry": {
              "name": "telemetry"
            },
            "assisted-replicator": {
              "assisted_replicator": {
                "ar_loopback_ip": "2.2.2.251"
              },
              "routing_instances": [
              {
                "export_targets": [
                  "target:64512:8000006"
                ],
                "virtual_network_mode": "l2",
                "vxlan_id": "7",
                "import_targets": [
                  "target:64512:8000006"
                ],
                "virtual_network_id": "7",
                "name": "_contrail_VN1-l2-7"
              }
              ],
              "vlans": [
              {
                "comment": "/* Virtual Network: VN1, UUID: b395a272-4cb3-4b85-8ff6-59830c29d670, Encapsulation: VXLAN */",
                "vxlan_id": 7,
                "description": "Virtual Network - VN1",
                "name": "bd-7"
              }
              ],
              "name": "assisted-replicator"
            }
          },
          "system": {
            "name": "DV488",
            "dummy_ip": "172.16.0.1",
            "is_ucast_gateway_only": false,
            "brownfield_global_asn": "",
            "uuid": "a0ab58f1-1cf4-4a7e-b60b-907b1a2153a1",
            "device_family": "junos-qfx",
            "encapsulation_priorities": [
              "VXLAN",
              "MPLSoUDP",
              "MPLSoGRE"
            ],
            "management_ip": "10.87.13.19",
            "routing_bridging_roles": [
              "AR-Replicator",
              "Route-Reflector"
            ],
            "credentials": {
              "authentication_method": "PasswordBasedAuthentication",
              "password": "cXj2rOsVXOf5sfgcb4fizw==",
              "user_name": "root"
            },
            "vendor_name": "Juniper",
            "product_name": "qfx10002-36q",
            "physical_role": "spine"
          }
        }

    - template:
        src: juniper_junos-qfx_overlay_assisted_replicator.j2
        dest: /tmp/output.json

    - command: cat /tmp/output.json
      register: output

    - debug: var=output.stdout_lines verbosity=1
