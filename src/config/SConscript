# -*- mode: python; -*-
#
# Copyright (c) 2013 Juniper Networks, Inc. All rights reserved.
#
# src directory

import os
import re
import sys

Import('BuildEnv')

CfgmEnv = BuildEnv.Clone()

# Documentation
CfgmDocFiles = []
CfgmDocFiles += CfgmEnv['BASE_DOC_FILES']
CfgmDocFiles += CfgmEnv['SANDESH_DOC_FILES']
CfgmDocFiles += CfgmEnv.SandeshGenDoc('uve/acl.sandesh')
CfgmDocFiles += CfgmEnv.SandeshGenDoc('uve/cfgm_cpuinfo.sandesh')
CfgmDocFiles += CfgmEnv.SandeshGenDoc('uve/physical_router.sandesh')
CfgmDocFiles += CfgmEnv.SandeshGenDoc('uve/service_instance.sandesh')
CfgmDocFiles += CfgmEnv.SandeshGenDoc('uve/vnc_api.sandesh')
CfgmDocFiles += CfgmEnv.SandeshGenDoc('uve/virtual_machine.sandesh')
CfgmDocFiles += CfgmEnv.SandeshGenDoc('uve/virtual_network.sandesh')
CfgmDocFiles += CfgmEnv.SandeshGenDoc('uve/msg_traces.sandesh')
CfgmDocFiles += CfgmEnv.SandeshGenDoc('uve/config_req.sandesh')
CfgmEnv['CFGM_DOC_FILES'] = CfgmDocFiles

#
# Deprecated
# Builds into build/<optimization>
#
subdirs=[
    'api-server',
    'common',
    'device-manager',
    'ironic-notification-manager',
    'schema-transformer',
    'utils',
    'uve',
    'vnc_openstack',
    'contrail_issu',
    'fabric-ansible',
]

CfgmEnv.SConscript(dirs=subdirs, exports='CfgmEnv', duplicate = 0)

#
# Build into build/noarch
#
# Using variant_dir in conjecture to duplicate = 1 allow the files from sources
# to be symlinked instead of hard copied to the build directory which will be a
# gain in latency during building and in velocity for debugging purpose.
#
# TODO: All modules should be migrated here.
if 'TOP_NOARCH' not in CfgmEnv:
    # TODO: This check shoukd be removed when CfgmEnv['TOP_NOARCH'] defined to
    # tools/rules.py.
    CfgmEnv['TOP_NOARCH'] = '#build/noarch'

noarch_subdirs = [
    'svc-monitor',
]
for sdir in noarch_subdirs:
    CfgmEnv.SConscript('#controller/src/config/%s/SConscript' % sdir, exports='CfgmEnv',
                       variant_dir='%s/config/%s' % (CfgmEnv['TOP_NOARCH'], sdir),
                       duplicate = 1)
